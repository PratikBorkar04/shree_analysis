<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Page</title>
    <!-- Include Select2 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f7fa;
            color: #333;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #3b8aa1;
            color: #fff;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: flex-start;
        }

        h1 {
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }

        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        button {
            background-color: #3b8aa1;
            color: #fff;
            border: none;
            padding: 6px 50px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            margin-top: 24px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .alert {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            margin-top: 20px;
            display: none;
        }

        #textFileContainer {
            margin-top: 20px;
            border: 1px solid #ccc;
            max-height: 400px;
            overflow-y: auto;
        }

        #textFileContainer table {
            width: 100%;
            border-collapse: collapse;
        }

        #textFileContainer th,
        #textFileContainer td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        .closeBtn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 6px 20px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .closeBtn:hover {
            background-color: #b71c1c;
        }
    </style>
</head>
<body>
    <header>
        <h1>State and Constituency Analysis</h1>
    </header>

    <div class="container">
        <div>
            <label for="state">State:</label>
            <select id="state" class="select2" style="width: 250px;">
                <option value="Maharashtra">Maharashtra</option>
                <option value="Karnataka">Karnataka</option>
                <!-- Add more states here if needed -->
            </select>
        </div>

        <div>
            <label for="constituency">Constituency:</label>
            <select id="constituency" class="select2" style="width: 250px;">
                <!-- JavaScript will populate this dropdown -->
            </select>
        </div>

        <button onclick="checkData()">Check</button>

        <div class="alert" id="resultAlert"></div>
    </div>

    <div id="textFileContainer"></div>

    <!-- Include jQuery (required by Select2) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Include Select2 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>

        const isLoggedIn = localStorage.getItem('isLoggedIn');

        // If not logged in, redirect to the login page
        if (!isLoggedIn) {
            window.location.href = "index.html";
        }
        // Initialize Select2 for both select elements with the "select2" class
        $('.select2').select2();

        // Array of constituencies for Maharashtra (you can expand this list)
        const constituencies = [
             "Akkalkuwa","Achalpur", "Aheri", "Ahmednagar City", "Ahmedpur", "Airoli", "Akole", "Akot", "Alibag", "Amalner", "Ambegaon",
            "Ambernath", "Amgaon", "Amravati", "Andheri East", "Andheri West", "Anushakti Nagar", "Arjuni-Morgaon", "Arni",
            "Ashti", "Aurangabad Central", "Aurangabad East", "Aurangabad West", "Ausa", "Badnapur", "Badnera", "Baglan",
            "Balapur", "Ballarpur", "Baramati", "Beed", "Belapur", "Bhandara", "Bhandup West", "Bhiwandi East", "Bhiwandi Rural",
            "Bhiwandi West", "Bhor", "Bhusawal", "Bhokardan", "Bhokar", "Bhosari", "Boisar", "Borivali", "Bramhapuri", "Chalisgaon",
            "Chandgad", "Chandrapur", "Chandwad", "Charkop", "Chembur", "Chikhali", "Chimur", "Chinchwad", "Chiplun", "Chopda",
            "Colaba", "Dahanu", "Dapoli", "Daryapur", "Daund", "Deglur", "Deoli", "Deolali", "Dharavi", "Dhule City", "Dhule Rural",
            "Dindori", "Dindoshi", "Dombivali", "Dombivali East", "Gadchiroli", "Gangakhed", "Gangapur", "Ghatkopar East",
            "Ghatkopar West", "Ghansawangi", "Gondiya", "Goregaon", "Georai", "Hadapsar", "Hadgaon", "Hinganghat", "Hingna",
            "Ichalkaranji", "Igatpuri", "Indapur", "Jalgaon City", "Jalgaon Jamod", "Jalgaon Rural", "Jalna", "Jamner", "Jat",
            "Jintur", "Jogeshwari East", "Junner", "Kadegaon", "Kaij", "Kalamb", "Kalina", "Kalwan", "Kalyan East", "Kalyan Rural",
            "Kalyan West", "Kamthi", "Kandivali East", "Kankavli", "Karad North", "Karad South", "Karanja", "Karjat", "Karjat jamkhed",
            "Kasba Peth", "Khadakwasala", "Khamgaon", "Khed Alandi", "Kherwadi", "Khopoli", "Kinwat", "Kodoli", "Kolhapur North",
            "Kolhapur South", "Kopargaon", "Kopri-Pachpakhadi", "Koregaon", "Kot", "Kothrud", "Kudal", "Kurla", "Latur City", "Latur Rural",
            "Majalgaon", "Makurdi", "Malkapur","Malegaon central","Malad West", "Malbar Hill","Malegaon outer", "Malshiras", "Mankhurd shivaji Nagar", "Man", "Maval",
            "Mehkar", "Melghat", "Miraj", "Mira Bhayandar", "Mohol", "Mulund", "Mumbadevi", "Mumbai Central", "Murbad","Mumbra-Kalwa", "Nagpur Central",
            "Nagpur East", "Nagpur North", "Nagpur South", "Nagpur South West", "Nagpur West", "Nalasopara", "Nandgaon", "Nandurbar",
            "Nashik central", "Nashik East", "Nashik West", "Navi Mumbai", "Navapur", "Neral", "Nevasa", "Nilanga", "Ovala-Majiwada",
            "Osmanabad", "Pachora", "Palandur", "Palghar", "Pandharpur", "Panvel", "Paranda", "Parbhani", "Parli", "Parner", "Partur",
            "Pathri", "Patan", "Pune Cantonment", "Purandar", "Pusad", "Rahuri", "Raigad", "Rajapur", "Rajura", "Ramtek", "Ratnagiri",
            "Raver", "Risod", "Sakoli", "Sakri", "Sangamner", "Sangli", "Sangola", "Satara", "Savner", "Sawantwadi", "Savli",
            "Shahada", "Shahapur", "Shahuwadi", "shahupur", "Shirala", "Shirur", "Shirpur", "Shivadi", "Shivajinagar", "Shrirampur",
            "Siddipet", "Sillod", "Sinnar", "Solapur City central", "Solapur City North", "Solapur South", "Srigonda", "Srinivasa Nagar",
            "Srinivasanagar", "Tasgaon-Kavathe Mahankal", "Teosa", "Thane", "Tirora", "Tuljapur", "Tumsar", "Udgir", "Umarkhed",
            "Umarga", "Umred", "Uran", "Vaijapur", "Vandre East", "Vandre West", "Vasai", "Vashi", "Vikhroli", "Vile parle",
            "Vikhroli", "Vikramgad", "Wadala", "Wai", "Wani", "Wardha", "Warora", "Washim", "Yavatmal"
            ];
        // Populate the "Constituency" select dropdown
        const constituencySelect = document.getElementById("constituency");
        constituencies.forEach(constituency => {
            const option = new Option(constituency, constituency);
            constituencySelect.add(option);
        });

        function checkData() {
            const stateValue = $('#state').val();
            const constituencyValue = $('#constituency').val();
            const alertText = `Selected State: ${stateValue}, Selected Constituency: ${constituencyValue}`;
            $('#resultAlert').html(alertText).slideDown();

            if (stateValue === "Maharashtra") {
                fetch("dataset/maharashtra_data.csv")
                    .then(response => response.text())
                    .then(csvData => {
                        // Parse CSV data using PapaParse
                        Papa.parse(csvData, {
                            header: true,
                            complete: function (parsedData) {
                                // Filter data based on constituency
                                const filteredData = parsedData.data.filter(row => row['Constituencies'] === constituencyValue);

                                // Create a table with the filtered data
                                const table = document.createElement('table');
                                table.style.borderCollapse = 'collapse';
                                table.style.width = '100%';

                                // Add table headers
                                const headers = Object.keys(filteredData[0]);
                                const headerRow = document.createElement('tr');
                                headers.forEach(header => {
                                    const th = document.createElement('th');
                                    th.textContent = header;
                                    th.style.border = '1px solid #ccc';
                                    th.style.padding = '8px';
                                    headerRow.appendChild(th);
                                });
                                table.appendChild(headerRow);

                                // Add table rows with filtered data
                                filteredData.forEach(rowData => {
                                    const row = document.createElement('tr');
                                    headers.forEach(header => {
                                        const cell = document.createElement('td');
                                        cell.textContent = rowData[header];
                                        cell.style.border = '1px solid #ccc';
                                        cell.style.padding = '8px';
                                        row.appendChild(cell);
                                    });
                                    table.appendChild(row);
                                });

                                const textFileContainer = document.getElementById('textFileContainer');
                                textFileContainer.innerHTML = ''; // Clear existing content
                                textFileContainer.appendChild(table);

                                // Add close button to remove the table
                                const closeBtn = document.createElement('button');
                                closeBtn.textContent = 'Close Table';
                                closeBtn.className = 'closeBtn';
                                closeBtn.style.display = 'block';
                                closeBtn.style.margin = '0 auto';
                                closeBtn.addEventListener('click', function () {
                                    textFileContainer.innerHTML = ''; // Remove the table
                                    closeBtn.remove(); // Remove the close button
                                    $('#resultAlert').slideUp(); // Slide up the alert
                                });
                                textFileContainer.appendChild(closeBtn);
                            }
                        });
                    });
            } else {
                const textFileContainer = document.getElementById('textFileContainer');
                textFileContainer.innerHTML = ''; // Clear existing content
            }
        }
    </script>
</body>
</html>
