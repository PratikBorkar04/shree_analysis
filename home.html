<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Page</title>
    <!-- Include Select2 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f7fa;
            color: #333;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #3b8aa1;
            color: #fff;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: flex-start;
        }

        h1 {
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }

        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        button {
            background-color: #3b8aa1;
            color: #fff;
            border: none;
            padding: 6px 50px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            margin-top: 24px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .alert {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            margin-top: 20px;
            display: none;
        }

        #textFileContainer {
            margin-top: 20px;
            border: 1px solid #ccc;
            max-height: 400px;
            overflow-y: auto;
        }

        #textFileContainer table {
            width: 100%;
            border-collapse: collapse;
        }

        #textFileContainer th,
        #textFileContainer td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        .closeBtn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 6px 20px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .closeBtn:hover {
            background-color: #b71c1c;
        }
    </style>
</head>
<body>
    <header>
        <h1>State and Constituency Analysis</h1>
    </header>

    <div class="container">
        <div>
            <label for="state">State:</label>
            <select id="state" class="select2" style="width: 250px;">
                <option value="Maharashtra">Maharashtra</option>
                <option value="Karnataka">Karnataka</option>
                <!-- Add more states here if needed -->
            </select>
        </div>

        <div>
            <label for="constituency">Constituency:</label>
            <select id="constituency" class="select2" style="width: 250px;">
                <!-- JavaScript will populate this dropdown -->
            </select>
        </div>

        <button onclick="checkData()">Check</button>

        <div class="alert" id="resultAlert"></div>
    </div>

    <div id="textFileContainer"></div>

    <!-- Include jQuery (required by Select2) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Include Select2 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>

        const isLoggedIn = localStorage.getItem('isLoggedIn');

        // If not logged in, redirect to the login page
        if (!isLoggedIn) {
            window.location.href = "index.html";
        }
        // Initialize Select2 for both select elements with the "select2" class
        $('.select2').select2();

        // Array of constituencies for Maharashtra (you can expand this list)
        const constituencies = [
        "Achalpur", "Aheri", "Ahmadpur", "Ahmednagar City", "Airoli", "Akkalkot", "Akkalkuwa", "Akola East", "Akola West", "Akole", "Akot",
        "Alibag", "Amalner", "Ambegaon", "Ambernath", "Amgaon", "Amravati", "Andheri East", "Andheri West", "Anushakti Nagar", "Arjuni-morgaon",
        "Armori", "Arni", "Arvi", "Ashti", "Aurangabad central", "Aurangabad East", "Aurangabad West", "Ausa", "Badnapur", "Badnera", "Baglan",
        "Balapur", "Ballarpur", "Baramati", "Barshi", "Basmath", "Beed", "Belapur", "Bhandara", "Bhandup West", "Bhiwandi East", "Bhiwandi Rural (S.T.)",
        "Bhiwandi West", "Bhokar", "Bhokardan", "Bhor", "Bhosari", "Bhusawal", "Boisar", "Borivali", "Brahmapuri", "Buldhana", "Byculla", "Chalisgaon",
        "Chandgad", "Chandivali", "Chandrapur", "Chandvad", "Charkop", "Chembur", "Chikhli", "Chimur", "Chinchwad", "Chiplun", "Chopda", "Colaba", "Dahanu",
        "Dahisar", "Dapoli", "Daryapur", "Daund", "Deglur", "Deoli", "Devlali", "Dhamamgaon railway", "Dharavi", "Dhule City", "Dhule Rural", "Digras",
        "Dindori", "Dindoshi", "Dombivali", "Erandol", "Gadchiroli", "Gangakhed", "Gangapur", "Georai", "Ghansawangi", "Ghatkopar East", "Ghatkopar West",
        "Gondiya", "Goregaon", "Guhagar", "Hadapsar", "Hadgaon", "Hatkanangle", "Hinganghat", "Hingna", "Hingoli", "Ichalkaranji", "Igatpuri", "Indapur",
        "Islampur", "Jalgaon (Jamod)", "Jalgaon City", "Jalgaon Rural", "Jalna", "Jamner", "Jath", "Jintur", "Jogeshwari East", "Junnar", "Kagal", "Kaij",
        "Kalamnuri", "Kalina", "Kalwan", "Kalyan East", "Kalyan Rural", "Kalyan West", "Kamthi", "Kandivali East", "Kankavli", "Kannad", "Karad North",
        "Karad South", "Karanja", "Karjat", "Karjat jamkhed", "Karmala", "Karvir", "Kasbapeth", "Katol", "Khadakwasala", "Khamgaon", "Khanapur",
        "Khed alandi", "Kinwat", "Kolhapur North", "Kolhapur South", "Kopargaon", "Kopri-Pachpakhadi", "Koregaon", "Kothrud", "Kudal", "Kurla(SC)",
        "Latur City", "Latur Rural", "Loha", "Madha", "Magathane", "Mahad", "Mahim", "Majalgaon", "Malabar hill", "Malad West", "Malegaon central",
        "Malegaon outer", "Malkapur", "Malshiras", "Man", "Mankhurd shivaji Nagar", "Maval", "Mehkar", "Melghat", "Mira Bhayandar", "Miraj", "Mohol",
        "Morshi", "Mukhed", "Muktainagar", "Mulund", "Mumbadevi", "Mumbra-Kalwa", "Murbad", "Murtizapur", "Nagpur central", "Nagpur East", "Nagpur North",
        "Nagpur South", "Nagpur South West", "Nagpur West", "Naigaon", "Nalasopara", "Nanded North", "Nanded South", "Nandgaon", "Nandurbar", "Nashik central",
        "Nashik East", "Nashik West", "Nawapur", "Nevasa", "Nilanga", "Niphad", "Osmanabad", "Ovala - Majiwada", "Pachora", "Paithan", "Palghar", "Palus-Kadegaon",
        "Pandharpur", "Panvel", "Paranda", "Parbhani", "Parli", "Parner", "Partur", "Parvati", "Patan", "Pathri", "Pen", "Phaltan", "Phulambri", "Pimpri",
        "Pune cantonment", "Purandar", "Pusad", "Radhanagari", "Rahuri", "Rajapur", "Rajura", "Ralegaon", "Ramtek", "Ratnagiri", "Raver", "Risod", "Sakoli",
        "Sakri", "Sangamner", "Sangli", "Sangola", "Satara", "Savner", "Sawantwadi", "Shahada", "shahapur", "Shahuwadi", "Shevgaon", "Shindkheda", "Shirala",
        "Shirdi", "Shirol", "Shirpur", "Shirur", "Shivadi", "Shivajinagar", "Shrigonda", "Shrirampur", "Shrivardhan", "Sillod", "Sindkhed Raja", "Sinnar",
        "Sion koliwada", "Solapur City central", "Solapur City North", "Solapur South", "Tasgaon-Kavathe Mahankal", "Teosa", "Thane", "Tirora", "Tuljapur",
        "Tumsar", "Udgir", "Ulhasnagar", "Umarga", "Umarkhed", "Umred", "Uran", "VADGAON SHERI", "Vaijapur", "Vandre East", "Vandre West", "Vasai", "Versova",
        "Vikhroli", "Vikramgad", "Vile parle", "Wadala", "Wai", "Wani", "Wardha", "Warora", "Washim", "Worli", "Yavatmal", "Yevla"
        ];
        // Populate the "Constituency" select dropdown
        const constituencySelect = document.getElementById("constituency");
        constituencies.forEach(constituency => {
            const option = new Option(constituency, constituency);
            constituencySelect.add(option);
        });

        function checkData() {
            const stateValue = $('#state').val();
            const constituencyValue = $('#constituency').val();
            const alertText = `Selected State: ${stateValue}, Selected Constituency: ${constituencyValue}`;
            $('#resultAlert').html(alertText).slideDown();

            if (stateValue === "Maharashtra") {
                fetch("dataset/maharashtra_data.csv")
                    .then(response => response.text())
                    .then(csvData => {
                        // Parse CSV data using PapaParse
                        Papa.parse(csvData, {
                            header: true,
                            complete: function (parsedData) {
                                // Filter data based on constituency
                                const filteredData = parsedData.data.filter(row => row['Constituencies'] === constituencyValue);

                                // Create a table with the filtered data
                                const table = document.createElement('table');
                                table.style.borderCollapse = 'collapse';
                                table.style.width = '100%';

                                // Add table headers
                                const headers = Object.keys(filteredData[0]);
                                const headerRow = document.createElement('tr');
                                headers.forEach(header => {
                                    const th = document.createElement('th');
                                    th.textContent = header;
                                    th.style.border = '1px solid #ccc';
                                    th.style.padding = '8px';
                                    headerRow.appendChild(th);
                                });
                                table.appendChild(headerRow);

                                // Add table rows with filtered data
                                filteredData.forEach(rowData => {
                                    const row = document.createElement('tr');
                                    headers.forEach(header => {
                                        const cell = document.createElement('td');
                                        cell.textContent = rowData[header];
                                        cell.style.border = '1px solid #ccc';
                                        cell.style.padding = '8px';
                                        row.appendChild(cell);
                                    });
                                    table.appendChild(row);
                                });

                                const textFileContainer = document.getElementById('textFileContainer');
                                textFileContainer.innerHTML = ''; // Clear existing content
                                textFileContainer.appendChild(table);

                                // Add close button to remove the table
                                const closeBtn = document.createElement('button');
                                closeBtn.textContent = 'Close Table';
                                closeBtn.className = 'closeBtn';
                                closeBtn.style.display = 'block';
                                closeBtn.style.margin = '0 auto';
                                closeBtn.addEventListener('click', function () {
                                    textFileContainer.innerHTML = ''; // Remove the table
                                    closeBtn.remove(); // Remove the close button
                                    $('#resultAlert').slideUp(); // Slide up the alert
                                });
                                textFileContainer.appendChild(closeBtn);
                            }
                        });
                    });
            } else {
                const textFileContainer = document.getElementById('textFileContainer');
                textFileContainer.innerHTML = ''; // Clear existing content
            }
        }
    </script>
</body>
</html>
